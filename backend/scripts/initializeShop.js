const { query } = require('../src/database/connection');
const logger = require('../src/utils/logger');

const sampleProducts = [
  {
    name: '–ê–º—É–ª–µ—Ç –ó–∞—Ö–∏—Å—Ç—É',
    description: '–ü–æ—Ç—É–∂–Ω–∏–π –∞–º—É–ª–µ—Ç –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ—ó –µ–Ω–µ—Ä–≥—ñ—ó —Ç–∞ –∑–ª–∏—Ö –¥—É—Ö—ñ–≤. –í–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–π –∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ —Å—Ä—ñ–±–ª–∞ —Ç–∞ –æ—Å–≤—è—á–µ–Ω–∏–π –ø—ñ–¥ —á–∞—Å –ø–æ–≤–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è.',
    price: 1500,
    category: '–∞–º—É–ª–µ—Ç–∏',
    images: [
      { url: '/images/products/amulet-protection.jpg', alt: '–ê–º—É–ª–µ—Ç –ó–∞—Ö–∏—Å—Ç—É' }
    ],
    inventory_count: 15
  },
  {
    name: '–ö—Ä–∏—Å—Ç–∞–ª –ê–º–µ—Ç–∏—Å—Ç—É',
    description: '–í–∏—Å–æ–∫–æ—è–∫—ñ—Å–Ω–∏–π –∫—Ä–∏—Å—Ç–∞–ª –∞–º–µ—Ç–∏—Å—Ç—É –¥–ª—è –º–µ–¥–∏—Ç–∞—Ü—ñ—ó —Ç–∞ –¥—É—Ö–æ–≤–Ω–æ–≥–æ –æ—á–∏—â–µ–Ω–Ω—è. –°–ø—Ä–∏—è—î —Ä–æ–∑–≤–∏—Ç–∫—É —ñ–Ω—Ç—É—ó—Ü—ñ—ó —Ç–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É–¥—Ä–æ—Å—Ç—ñ.',
    price: 800,
    category: '–∫—Ä–∏—Å—Ç–∞–ª–∏',
    images: [
      { url: '/images/products/amethyst-crystal.jpg', alt: '–ö—Ä–∏—Å—Ç–∞–ª –ê–º–µ—Ç–∏—Å—Ç—É' }
    ],
    inventory_count: 25
  },
  {
    name: '–°–≤—ñ—á–∫–∞ –†–∏—Ç—É–∞–ª—å–Ω–∞ –ß–µ—Ä–≤–æ–Ω–∞',
    description: '–ß–µ—Ä–≤–æ–Ω–∞ —Å–≤—ñ—á–∫–∞ –¥–ª—è —Ä–∏—Ç—É–∞–ª—ñ–≤ –∫–æ—Ö–∞–Ω–Ω—è, –ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç—ñ —Ç–∞ –∂–∏—Ç—Ç—î–≤–æ—ó —Å–∏–ª–∏. –í–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ –≤–æ—Å–∫—É –∑ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º –µ—Ñ—ñ—Ä–Ω–∏—Ö –æ–ª—ñ–π.',
    price: 200,
    category: '—Å–≤—ñ—á–∫–∏',
    images: [
      { url: '/images/products/red-ritual-candle.jpg', alt: '–ß–µ—Ä–≤–æ–Ω–∞ –†–∏—Ç—É–∞–ª—å–Ω–∞ –°–≤—ñ—á–∫–∞' }
    ],
    inventory_count: 50
  },
  {
    name: '–ö–æ–ª–æ–¥–∞ –¢–∞—Ä–æ –†–∞–π–¥–µ—Ä–∞-–£–µ–π—Ç–∞',
    description: '–ö–ª–∞—Å–∏—á–Ω–∞ –∫–æ–ª–æ–¥–∞ –∫–∞—Ä—Ç –¢–∞—Ä–æ –†–∞–π–¥–µ—Ä–∞-–£–µ–π—Ç–∞. –Ü–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å —è–∫ –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤, —Ç–∞–∫ —ñ –¥–ª—è –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏—Ö —Ç–∞—Ä–æ–ª–æ–≥—ñ–≤.',
    price: 1200,
    category: '—Ç–∞—Ä–æ',
    images: [
      { url: '/images/products/rider-waite-tarot.jpg', alt: '–ö–æ–ª–æ–¥–∞ –¢–∞—Ä–æ –†–∞–π–¥–µ—Ä–∞-–£–µ–π—Ç–∞' }
    ],
    inventory_count: 20
  },
  {
    name: '–ù–∞–±—ñ—Ä –†—É–Ω—ñ—á–Ω–∏—Ö –ö–∞–º–µ–Ω—ñ–≤',
    description: '–ü–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä –∑ 25 —Ä—É–Ω—ñ—á–Ω–∏—Ö –∫–∞–º–µ–Ω—ñ–≤, –≤–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—Ö –∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞–Ω—ñ—Ç—É. –í–∫–ª—é—á–∞—î –º—ñ—à–µ—á–æ–∫ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é.',
    price: 2000,
    category: '—Ä—É–Ω—ñ—á–Ω—ñ-–∫–∞–º–µ–Ω—ñ',
    images: [
      { url: '/images/products/rune-stones-set.jpg', alt: '–ù–∞–±—ñ—Ä –†—É–Ω—ñ—á–Ω–∏—Ö –ö–∞–º–µ–Ω—ñ–≤' }
    ],
    inventory_count: 12
  },
  {
    name: '–ú–∞–≥—ñ—á–Ω–∏–π –ñ–µ–∑–ª –∑ –ö–≤–∞—Ä—Ü–æ–º',
    description: '–î–µ—Ä–µ–≤\'—è–Ω–∏–π –∂–µ–∑–ª –∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∏–º –∫–≤–∞—Ä—Ü–æ–º –Ω–∞ –∫—ñ–Ω—Ü—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó –ø—ñ–¥ —á–∞—Å —Ä–∏—Ç—É–∞–ª—ñ–≤ —Ç–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω—å.',
    price: 3500,
    category: '–º–∞–≥—ñ—á–Ω—ñ-—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏',
    images: [
      { url: '/images/products/magic-wand-quartz.jpg', alt: '–ú–∞–≥—ñ—á–Ω–∏–π –ñ–µ–∑–ª –∑ –ö–≤–∞—Ä—Ü–æ–º' }
    ],
    inventory_count: 8
  },
  {
    name: '–ö–Ω–∏–≥–∞ "–û—Å–Ω–æ–≤–∏ –ú–∞–≥—ñ—ó"',
    description: '–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∑ –æ—Å–Ω–æ–≤ –º–∞–≥—ñ—á–Ω–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫. –ú—ñ—Å—Ç–∏—Ç—å —Ç–µ–æ—Ä—ñ—é, –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –≤–ø—Ä–∞–≤–∏ —Ç–∞ —Ä–∏—Ç—É–∞–ª–∏ –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤.',
    price: 900,
    category: '–∫–Ω–∏–≥–∏',
    images: [
      { url: '/images/products/magic-basics-book.jpg', alt: '–ö–Ω–∏–≥–∞ –û—Å–Ω–æ–≤–∏ –ú–∞–≥—ñ—ó' }
    ],
    inventory_count: 30
  },
  {
    name: '–ï—Ñ—ñ—Ä–Ω–∞ –û–ª—ñ—è –õ–∞–≤–∞–Ω–¥–∏',
    description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞ –µ—Ñ—ñ—Ä–Ω–∞ –æ–ª—ñ—è –ª–∞–≤–∞–Ω–¥–∏ –¥–ª—è —Ä–µ–ª–∞–∫—Å–∞—Ü—ñ—ó, –æ—á–∏—â–µ–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ—Ä—É —Ç–∞ –º–∞–≥—ñ—á–Ω–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫. –û–±\'—î–º 10 –º–ª.',
    price: 350,
    category: '–æ–ª—ñ—ó',
    images: [
      { url: '/images/products/lavender-oil.jpg', alt: '–ï—Ñ—ñ—Ä–Ω–∞ –û–ª—ñ—è –õ–∞–≤–∞–Ω–¥–∏' }
    ],
    inventory_count: 40
  },
  {
    name: '–°—É—à–µ–Ω–∞ –®–∞–≤–ª—ñ—è',
    description: '–í–∏—Å—É—à–µ–Ω–∞ —à–∞–≤–ª—ñ—è –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ—Ä—É –≤—ñ–¥ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ—ó –µ–Ω–µ—Ä–≥—ñ—ó. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –æ–∫—É—Ä—é–≤–∞–Ω–Ω—è —Ç–∞ —Ä–∏—Ç—É–∞–ª—ñ–≤ –æ—á–∏—â–µ–Ω–Ω—è.',
    price: 150,
    category: '—Ç—Ä–∞–≤–∏',
    images: [
      { url: '/images/products/dried-sage.jpg', alt: '–°—É—à–µ–Ω–∞ –®–∞–≤–ª—ñ—è' }
    ],
    inventory_count: 60
  },
  {
    name: '–ú—ñ–Ω–µ—Ä–∞–ª –ß–æ—Ä–Ω–∏–π –¢—É—Ä–º–∞–ª—ñ–Ω',
    description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∏–π —á–æ—Ä–Ω–∏–π —Ç—É—Ä–º–∞–ª—ñ–Ω –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ—ó –µ–Ω–µ—Ä–≥—ñ—ó —Ç–∞ –µ–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω—ñ—Ç–Ω–æ–≥–æ –≤–∏–ø—Ä–æ–º—ñ–Ω—é–≤–∞–Ω–Ω—è.',
    price: 600,
    category: '–º—ñ–Ω–µ—Ä–∞–ª–∏',
    images: [
      { url: '/images/products/black-tourmaline.jpg', alt: '–ß–æ—Ä–Ω–∏–π –¢—É—Ä–º–∞–ª—ñ–Ω' }
    ],
    inventory_count: 18
  },
  {
    name: '–¢–∞–ª—ñ—Å–º–∞–Ω –£–¥–∞—á—ñ',
    description: '–£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Ç–∞–ª—ñ—Å–º–∞–Ω –¥–ª—è –∑–∞–ª—É—á–µ–Ω–Ω—è —É–¥–∞—á—ñ —Ç–∞ —É—Å–ø—ñ—Ö—É –≤ —É—Å—ñ—Ö —Å–ø—Ä–∞–≤–∞—Ö. –í–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–π –∑–∞ –¥—Ä–µ–≤–Ω—ñ–º–∏ —Ä–µ—Ü–µ–ø—Ç–∞–º–∏.',
    price: 1800,
    category: '—Ç–∞–ª—ñ—Å–º–∞–Ω–∏',
    images: [
      { url: '/images/products/luck-talisman.jpg', alt: '–¢–∞–ª—ñ—Å–º–∞–Ω –£–¥–∞—á—ñ' }
    ],
    inventory_count: 10
  },
  {
    name: '–†–∏—Ç—É–∞–ª—å–Ω–∞ –ß–∞—à–∞',
    description: '–ú—ñ–¥–Ω–∞ —á–∞—à–∞ –¥–ª—è —Ä–∏—Ç—É–∞–ª—å–Ω–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫, –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è –∑—ñ–ª–ª—è —Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è —Ü–µ—Ä–µ–º–æ–Ω—ñ–π. –ü—Ä–∏–∫—Ä–∞—à–µ–Ω–∞ —Å–∞–∫—Ä–∞–ª—å–Ω–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏.',
    price: 2500,
    category: '—Ä–∏—Ç—É–∞–ª—å–Ω—ñ-–ø—Ä–µ–¥–º–µ—Ç–∏',
    images: [
      { url: '/images/products/ritual-chalice.jpg', alt: '–†–∏—Ç—É–∞–ª—å–Ω–∞ –ß–∞—à–∞' }
    ],
    inventory_count: 6
  }
];

async function initializeShop() {
  try {
    logger.info('–ü–æ—á–∞—Ç–æ–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–∞–≥–∞–∑–∏–Ω—É...');

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –≤–∂–µ —Ç–æ–≤–∞—Ä–∏ –≤ –±–∞–∑—ñ
    const existingProducts = await query('SELECT COUNT(*) as count FROM products');
    const productCount = parseInt(existingProducts.rows[0].count);

    if (productCount > 0) {
      logger.info(`–£ –±–∞–∑—ñ –≤–∂–µ —î ${productCount} —Ç–æ–≤–∞—Ä—ñ–≤. –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é.`);
      return;
    }

    // –î–æ–¥–∞—î–º–æ —Ç–æ–≤–∞—Ä–∏
    for (const product of sampleProducts) {
      await query(
        `INSERT INTO products (name, description, price, category, images, inventory_count, status) 
         VALUES ($1, $2, $3, $4, $5, $6, $7)`,
        [
          product.name,
          product.description,
          product.price,
          product.category,
          JSON.stringify(product.images),
          product.inventory_count,
          'active'
        ]
      );
      
      logger.info(`–î–æ–¥–∞–Ω–æ —Ç–æ–≤–∞—Ä: ${product.name}`);
    }

    logger.info(`‚úÖ –£—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ ${sampleProducts.length} —Ç–æ–≤–∞—Ä—ñ–≤ –¥–æ –º–∞–≥–∞–∑–∏–Ω—É`);
    
    // –í–∏–≤–æ–¥–∏–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
    const categoryStats = await query(`
      SELECT category, COUNT(*) as count, SUM(inventory_count) as total_inventory
      FROM products 
      WHERE status = 'active'
      GROUP BY category 
      ORDER BY category
    `);

    logger.info('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö:');
    categoryStats.rows.forEach(row => {
      logger.info(`  ${row.category}: ${row.count} —Ç–æ–≤–∞—Ä—ñ–≤, ${row.total_inventory} –æ–¥–∏–Ω–∏—Ü—å –Ω–∞ —Å–∫–ª–∞–¥—ñ`);
    });

  } catch (error) {
    logger.error('‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–∞–≥–∞–∑–∏–Ω—É:', error.message);
    throw error;
  }
}

// –ó–∞–ø—É—Å–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —è–∫—â–æ —Ñ–∞–π–ª –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É
if (require.main === module) {
  const { connectDatabase } = require('../src/database/connection');
  
  async function run() {
    try {
      await connectDatabase();
      await initializeShop();
      process.exit(0);
    } catch (error) {
      logger.error('–ü–æ–º–∏–ª–∫–∞:', error);
      process.exit(1);
    }
  }
  
  run();
}

module.exports = { initializeShop };